title: disrupted Home
views:
  - id: 0
    title: default_view
    icon: "mdi:home-assistant"
    cards:
      - type: vertical-stack
        cards:
          - type: horizontal-stack
            cards:
              - type: "custom:button-card"
                entity: person.salomon
                entity_picture: /local/memoji_salomon.png
                show_entity_picture: true
                aspect_ratio: 1/1
                name: >-
                  [[[
                    var device_tracker = states['person.salomon'].state
                    if (device_tracker === 'not_home')
                      return `Away ${states['proximity.home_salomon'].state}km`;
                    else
                      return device_tracker;
                  ]]]
                styles:
                  card:
                    - border-radius: 4%
                    - padding: 7%
                    - padding-bottom: 4%
                    - font-size: 10px
                  grid:
                    - grid-template-areas: '"i battery" "n n" "steps steps" "distance distance" "update update"'
                    - grid-template-columns: 1fr 1fr
                    - grid-template-rows: 1fr min-content min-content min-content min-content
                  name:
                    - font-weight: bold
                    - font-size: 18px
                    - align-self: middle
                    - justify-self: start
                    - padding-bottom: 6px
                    - text-transform: capitalize
                  img_cell:
                    - justify-content: start
                    - align-items: start
                    - margin: none
                  icon:
                    - max-height: 90%
                    - width: auto
                    - height: auto
                  custom_fields:
                    steps:
                      - padding-bottom: 2px
                      - align-self: middle
                      - justify-self: start
                      - font-size: 12px
                    distance:
                      - padding-bottom: 2px
                      - align-self: middle
                      - justify-self: start
                      - font-size: 12px
                    update:
                      - align-self: middle
                      - justify-self: end
                      - font-size: 11px
                custom_fields:
                  steps: |
                    [[[
                      return `<ha-icon
                        icon="mdi:walk"
                        style="width: 20px; height: 20px;">
                        </ha-icon>  <span style="padding-left: 4px; position: relative; top: 1px;">${states['sensor.disrupted_iphone_steps'].state} steps</span>`
                    ]]]
                  distance: |
                    [[[
                      return `<ha-icon
                        icon="mdi:map-marker-distance"
                        style="width: 20px; height: 20px;">
                        </ha-icon>  <span style="padding-left: 4px; position: relative; top: 1px;">${states['sensor.disrupted_iphone_distance'].state} m</span>`
                    ]]]
                  update: |
                    [[[
                      return html`
                        <ha-relative-time
                          id="label"
                          class="ellipsis"
                          .hass="${hass}"
                          .datetime="${entity.last_updated}"
                        ></ha-relative-time>`
                    ]]]
          # - type: "custom:auto-entities"
          #   card:
          #     type: glance
          #     title: Who's at home
          #     show_state: false
          #   filter:
          #     include:
          #       - group: group.all_people
          #         state: "home"
          - type: "custom:stack-in-card"
            mode: vertical
            cards:
              - type: entities
                show_header_toggle: false
                entities:
                  - type: custom:secondaryinfo-entity-row
                    entity: input_boolean.present
                    secondary_info: "[[ sensor.time_outside_salomon ]] h outside today"
                  - lock.door_lock
                  - light.corridor
                  - type: custom:secondaryinfo-entity-row
                    entity: sensor.day_phase
                    secondary_info: "[[ sensor.sun_daylight_remaining ]] h"
              - type: history-graph
                hours_to_show: 12
                refresh_interval: 60
                entities:
                  - input_boolean.present
                  - person.salomon
      - type: entities
        show_header_toggle: false
        entities:
          - input_select.scene
          - entity: automation.light_adaptive_apply
            name: Adaptive Light
          - sensor.adaptive_colortemp
          - input_number.scene_brightness
          - input_number.scene_color_temp
      - type: "custom:mini-media-player"
        entity: media_player.spotify
        artwork: full-cover-fit
        hide:
          name: true
          power: true
          volume: true
        name: Spotify Player
        scroll_info: true
        show_progress: true
        show_source: small
      - type: vertical-stack
        cards:
          - type: entities
            entities:
              - type: custom:secondaryinfo-entity-row
                entity: vacuum.nono
                secondary_info: "Last cleaning [[ sensor.vacuum_days_since_last_clean.state ]] days ago"
      #     - type: custom:vacuum-card
      #       entity: vacuum.nono
      #       map: camera.nono_map
      #       actions:
      #         - name: Empty bin
      #           service: script.vacuum_empty_bin
      #           icon: mdi:delete-empty
      #         - name: Load map
      #           service: script.vacuum_load_map
      #           icon: mdi:map-check-outline
      #         - name: Clean living room
      #           service: script.vacuum_clean_livingroom
      #           icon: mdi:seat-recline-extra
      #         - name: Clean sofa
      #           service: script.vacuum_clean_sofa
      #           icon: mdi:sofa
      #         - name: Clean desk
      #           service: script.vacuum_clean_desk
      #           icon: mdi:desk
      #         - name: Clean bathroom
      #           service: script.vacuum_clean_bathroom
      #           icon: mdi:shower
      #   - name: Clean kitchen
      #     service: script.clean_kitchen
      #     icon: mdi:fridge   #mdi:chef-hat
      #   - name: Clean corridor
      #     service: script.clean_corridor
      #     icon: mdi:door-closed
      # - type: 'custom:xiaomi-vacuum-card'
      #   entity: vacuum.nono
      #   name: Nono
      #   image: /local/img/xiaomi-vacuum-dark.jpg
      #   buttons:
      #     start: false
      #     - type: picture-glance
      #       entities: []
      #       camera_image: camera.nono_map
      # - type: 'custom:valetudo-map-card'
      #   title: ''
      #   entity: sensor.nono_map
      #   vacuum_entity: vacuum.nono
      #   map_scale: 1
      #   icon_scale: 1
      #   rotate: 0
      #   crop:
      #     top: 0
      #     bottom: 0
      #     left: 40
      #     right: 0
      #   # floor_color: darkgrey
      #   obstacle_weak_color: yellow
      #   obstacle_strong_color: green #'#A1DBFE'
      # - type: picture-glance
      #   entities: []
      #   camera_image: camera.xiaofang
      #   show_state: false
  - id: 1
    title: Livingroom
    icon: "mdi:sofa"
    panel: true
    cards:
      - type: custom:layout-card
        layout_type: custom:vertical-layout
        cards:
          - type: entities
            show_header_toggle: false
            entities:
              - type: custom:fold-entity-row
                head:
                  type: custom:slider-entity-row
                  name: Living
                  color_picker: true
                  entity: light.livingroom
                entities:
                  - entity: light.floor_lamp
                    secondary_info: brightness
                  - entity: light.reading_lamp
                    secondary_info: brightness
                  - entity: light.spots
                    secondary_info: brightness
                  - light.string
                  - light.candle
          - entities:
              - input_boolean.movietime
            type: entities
          - type: custom:layout-break
          - type: entities
            title: Multimedia
            show_header_toggle: false
            entities:
              - switch.amp
              - type: "custom:mini-media-player"
                entity: media_player.tv
                icon: "mdi:television"
                group: true
                hide:
                  controls: true
                  icon_state: false
                  power_state: false
                volume_stateless: true
          - type: "custom:mini-media-player"
            artwork: full-cover
            entity: media_player.apple_tv
            group: false
            hide:
              power: true
              progress: false
              shuffle: false
            volume_stateless: true
            replace_mute: stop
            source: full
            # shortcuts:
            #   buttons:
            #     - icon: "mdi:music"
            #       id: "special://profile/playlists/music/*****.m3u"
            #       name: "5 Stars"
            #       type: DIRECTORY
            #     - icon: "mdi:album"
            #       id: "special://profile/playlists/music/random album.xsp"
            #       name: Random
            #       type: DIRECTORY
            #     - icon: "mdi:music"
            #       id: "special://profile/playlists/music/2020.xsp"
            #       name: "2020"
            #       type: DIRECTORY
            #     - icon: "mdi:music"
            #       id: "special://profile/playlists/music/Drum & Bass.xsp"
            #       name: "D+B"
            #       type: DIRECTORY
            #     - icon: "mdi:radio"
            #       id: "http://fm4shoutcast.sf.apa.at/;"
            #       name: FM4
            #       type: MUSIC
            #   columns: 3
          - artwork: full-cover-fit
            entity: media_player.ps4
            group: false
            hide:
              controls: true
              info: false
              name: false
              power_state: false
              volume: true
            type: "custom:mini-media-player"
  - id: 2
    title: Bedroom
    icon: "mdi:bed-king"
    cards:
      - type: entities
        entities:
          - type: custom:fold-entity-row
            title: Light
            head:
              entity: light.bedroom_ceiling
              hide_when_off: false
              toggle: true
              type: "custom:slider-entity-row"
            entities:
              - entity: switch.adaptive_lighting_bed
                name: Adaptive
              - entity: switch.adaptive_lighting_bed_no_brightness
                name: Adaptive (no brightness)
          - light.bedside_lamp
          - fan.standing_fan
        show_header_toggle: false
      - type: "custom:mini-media-player"
        entity: media_player.bedroom_homepod
        name: HomePod
        artwork: material
        icon: "mdi:speaker"
        hide:
          power: true
      - entities:
          - type: custom:secondaryinfo-entity-row
            entity: input_boolean.sleeping
            secondary_info: "[[ sensor.total_sleep_last_night ]] h"
          - binary_sensor.bayesian_sleeping
        show_header_toggle: false
        theme: Backend-selected
        title: Sleep Tracking
        type: entities
      # - entities:
      #     - entity: sensor.disrupted_steps
      #     - entity: sensor.disrupted_distance
      #     - entity: sensor.disrupted_calories
      #     - entity: sensor.disrupted_sleep
      #   show_header_toggle: false
      #   theme: Backend-selected
      #   title: Fit
      #   type: entities
  - id: 3
    title: Kitchen
    icon: "mdi:food-variant"
    cards:
      - type: entities
        show_header_toggle: false
        entities:
          - light.kitchen_ceiling
          - light.cooker
          - light.countertop
          - switch.christmas_star
      - type: "custom:mini-media-player"
        entity: media_player.sonos_kitchen
        artwork: material
        icon: "mdi:speaker"
        hide:
          power: true
        shortcuts:
          columns: 3
          buttons:
            - name: "Spotify"
              icon: "mdi:spotify"
              type: MUSIC
              id: "spotify:playlist:37i9dQZF1DXbm6HfkbMtFZ"
            - name: BBC R1
              icon: "mdi:radio"
              type: MUSIC
              id: "http://a.files.bbci.co.uk/media/live/manifesto/audio/simulcast/hls/uk/sbr_high/llnw/bbc_radio_one.m3u8"
            - name: DLF Kultur
              icon: "mdi:radio"
              type: MUSIC
              id: "https://st02.sslstream.dlf.de/dlf/02/128/mp3/stream.mp3"
      - type: entities
        show_header_toggle: false
        entities:
          - type: custom:secondaryinfo-entity-row
            entity: binary_sensor.dishwasher
            icon: mdi:dishwasher
            secondary_info: "[[ sensor.dishwasher_power.state ]] W"
          - type: custom:secondaryinfo-entity-row
            entity: sensor.fridge
            icon: mdi:fridge
            secondary_info: "[[ sensor.fridge_power.state ]] W"
          - binary_sensor.fridge_door
      - type: entities
        show_header_toggle: false
        entities:
          - light.storage_ceiling
          - binary_sensor.storage_door
  - id: 4
    title: Bathroom
    icon: "mdi:shower-head"
    cards:
      - type: entities
        show_header_toggle: false
        entities:
          - light.bathroom_ceiling
          - light.mirror
          - entity: fan.bathroom
            secondary_info: last-changed
          - entity: binary_sensor.bathroom_motion
            secondary_info: last-updated
          - binary_sensor.bathroom_door
          - input_select.ambient_sound
          - type: "custom:mini-media-player"
            entity: media_player.google_home
            artwork: full-cover-fit
            hide:
              name: true
              power: true
              volume: true
            name: Speaker
            scroll_info: true
            show_progress: true
            show_source: small
      - type: "custom:mini-media-player"
        entity: media_player.bathroom_homepod
        name: HomePod
        artwork: material
        icon: "mdi:speaker"
        hide:
          power: true
      - type: entities
        show_header_toggle: false
        entities:
          - type: custom:secondaryinfo-entity-row
            entity: binary_sensor.washing_machine
            icon: mdi:washing-machine
            secondary_info: "[[ sensor.washing_machine_power.state ]] W"
      - type: "custom:auto-entities"
        card:
          show_header_toggle: false
          type: entities
        filter:
          include:
            - entity_id: automation.*bathroom*
              options:
                secondary_info: last-triggered
  - id: 5
    title: Desk
    icon: "mdi:monitor"
    badges:
      - device_tracker.disrupted_mba
      - device_tracker.disrupted_ipadpro
      - device_tracker.disrupted_iphone
    cards:
      - type: entities
        show_header_toggle: false
        entities:
          - type: "custom:slider-entity-row"
            entity: light.desk_lamp
            toggle: true
            hide_when_off: false
          - type: "custom:rgb-light-card"
            entity: light.desk_lamp
            justify: center
            hide_when_off: true
            colors:
              - color_temp: 200
                transition: 0.5
                icon_color: >-
                  linear-gradient(15deg,rgba(255,255,255,1) 20%,
                  rgba(193,193,193,1) 100%)
              - color_temp: 250
                transition: 0.5
                icon_color: >-
                  linear-gradient(15deg, rgba(255,231,185,1) 0%,
                  rgba(196,220,229,1) 100%)
              - color_temp: 300
                transition: 0.5
                icon_color: >-
                  linear-gradient(15deg, rgba(254,199,110,1) 0%,
                  rgba(233,233,233,1) 100%)
              - color_temp: 350
                transition: 0.5
                icon_color: >-
                  linear-gradient(15deg, rgba(255,220,167,1) 0%,
                  rgba(255,183,116,1) 100%)
              - color_temp: 400
                transition: 0.5
                icon_color: >-
                  linear-gradient(15deg, rgba(255,205,126,1) 0%,
                  rgba(252,156,49,1) 100%)
              - color_temp: 450
                transition: 0.5
                icon_color: >-
                  linear-gradient(15deg, rgba(255,190,92,1) 0%,
                  rgba(255,123,0,1) 100%)
      - type: entities
        entities:
          - sensor.e_studio382p
          - binary_sensor.disrupted_mba_active
          - binary_sensor.disrupted_mba_at_desk
          - binary_sensor.disrupted_mbp_active
          - binary_sensor.disrupted_mbp_at_desk
          - sensor.disrupted_mba_usage_today
          - sensor.disrupted_mba_primary_display_name
          - binary_sensor.disrupted_mba_audio_input_in_use
          - binary_sensor.disrupted_mba_audio_output_in_use
          - binary_sensor.disrupted_mba_camera_in_use
  - id: 6
    title: Weather
    icon: "mdi:weather-partly-cloudy"
    panel: true
    cards:
      - type: custom:layout-card
        layout_type: custom:vertical-layout
        layout:
          min_columns: 1
          max_columns: 2
        cards:
          - type: "custom:stack-in-card"
            mode: vertical
            cards:
              - entity: weather.home
                icons: "/hacsfiles/weather-card/icons/"
                type: "custom:weather-card"
              - type: markdown
                content: >-
                  {% set level_colors = ["#c5e566", "#ffeb3b", "#fb8c00", "#e53935", "#880e4f"] %}
                  {% set current_count = state_attr("sensor.dwd_weather_warnings_current_warning_level", "warning_count") %}
                  {% set advance_count = state_attr("sensor.dwd_weather_warnings_advance_warning_level", "warning_count") %}
                  {% if ((current_count == 0) and (advance_count == 0)) %}
                  **<font color={{ level_colors[0] }}>Keine Warnungen</font>**
                  {% else %}
                    {% for i in range(current_count) %}
                      {% set headline = state_attr("sensor.dwd_weather_warnings_current_warning_level", "warning_" ~ loop.index ~ "_headline") %}
                      {% set description = state_attr("sensor.dwd_weather_warnings_current_warning_level", "warning_" ~ loop.index ~ "_description") %}
                      {% set level = state_attr("sensor.dwd_weather_warnings_current_warning_level", "warning_" ~ loop.index ~ "_level") %}
                      {% set time_start = state_attr("sensor.dwd_weather_warnings_current_warning_level", "warning_" ~ loop.index ~ "_start") %}
                      {% set time_end = state_attr("sensor.dwd_weather_warnings_current_warning_level", "warning_" ~ loop.index ~ "_end") %}
                    **<font color={{ level_colors[level] }}>{{ headline }} (Level {{ states('sensor.dwd_weather_warnings_current_warning_level') }})</font>**
                    {{ time_start.strftime("%a %H:%M") ~ " - " ~ time_end.strftime("%a %H:%M") }}
                    *{{ description }}*
                    {% if not loop.last %}***{% endif %}
                    {% endfor %}
                    {% if ((current_count != 0) and (advance_count != 0)) %}***{% endif %}
                    {% for i in range(advance_count) %}
                      {% set headline = state_attr("sensor.dwd_weather_warnings_advance_warning_level", "warning_" ~ loop.index ~ "_headline") %}
                      {% set description = state_attr("sensor.dwd_weather_warnings_advance_warning_level", "warning_" ~ loop.index ~ "_description") %}
                      {% set level = state_attr("sensor.dwd_weather_warnings_advance_warning_level", "warning_" ~ loop.index ~ "_level") %}
                      {% set time_start = state_attr("sensor.dwd_weather_warnings_advance_warning_level", "warning_" ~ loop.index ~ "_start") %}
                      {% set time_end = state_attr("sensor.dwd_weather_warnings_advance_warning_level", "warning_" ~ loop.index ~ "_end") %}
                    **<font color={{ level_colors[level] }}>{{ headline }}</font>**
                    {{ time_start.strftime("%a %H:%M") ~ " - " ~ time_end.strftime("%a %H:%M") }}
                    *{{ description }}*
                    {% if not loop.last %}***{% endif %}
                    {% endfor %}
                  {% endif %}
          # - type: "custom:mini-graph-card"
          #   name: AQI
          #   # color_thresholds:
          #   #   - color: '#56a0ee'
          #   #     value: 50
          #   #   - color: '#d35400'
          #   #     value: 100
          #   #   - color: '#c0392b'
          #   #     value: 150
          #   entities:
          #     - entity: sensor.waqi
          #       name: AQI
          #       color: lightgrey
          #   hour24: true
          #   hours_to_show: 72
          #   line_width: 4
          #   # points_per_hour: 1
          #   decimals: 0
          #   # lower_bound: 0
          #   show:
          #     name: false
          #     icon: false
          #     labels: false
          #     extrema: true
          #     average: true
          #     fill: true
          - type: picture-glance
            entities: []
            camera_image: camera.rain_radar
            style: |
              div.box {
                display: none;
              }
          - type: custom:layout-break
          - type: picture
            image: !secret meteogram_url
          # - type: vertical-stack
          #   cards:
          #     - type: "custom:mini-graph-card"
          #       name: Temperature
          #       icon: "mdi:thermometer"
          #       color_thresholds:
          #         - color: "#56a0ee"
          #           value: 0
          #         - color: "#d35400"
          #           value: 20
          #         - color: "#c0392b"
          #           value: 30
          #       entities:
          #         - entity: sensor.htw_wetter_temperature
          #           name: Temperature
          #       hour24: true
          #       hours_to_show: 48
          #       line_width: 3
          #       decimals: 0
          #       show:
          #         labels: true
          #     - type: "custom:mini-graph-card"
          #       name: Precipitation
          #       icon: "mdi:weather-rainy"
          #       entities:
          #         - color: "#56A0EE"
          #           entity: sensor.dwd_wetter_precipitation
          #           name: Precipitation
          #       hour24: true
          #       hours_to_show: 48
          #       decimals: 1
          #       lower_bound: 0
          #       points_per_hour: 1
          #       show:
          #         graph: bar
          #     - type: "custom:mini-graph-card"
          #       name: Wind Speed
          #       entities:
          #         - entity: sensor.weather_yr_wind_speed
          #           name: YR
          #         - entity: sensor.htw_wetter_wind_speed_statistics
          #           name: HTW
          #         - entity: sensor.htw_wetter_wind_speed_max
          #           name: max
          #       hour24: true
          #       hours_to_show: 48
          #       icon: "mdi:weather-windy"
          #       line_color: "#4bc0c0"
          #       line_width: 3
          #       decimals: 0

  - id: 7
    title: Weather details
    icon: "mdi:weather-partly-cloudy"
    type: custom:horizontal-layout
    layout:
      min_columns: 1
      max_columns: 3
    cards:
      - type: entities
        entities:
          - binary_sensor.rain
          - sensor.weather_bad_weather
          - sensor.weather_wind
          - sensor.weather_rain
          - sensor.temperature_change_per_hour
          # - entity: sensor.htw_wetter_wind_speed_statistics
          #   name: Wind Speed mean
          #   icon: mdi:weather-windy
          # - sensor.htw_wetter_wind_speed_max
          # - entity: sensor.htw_wetter_solar_radiation_statistics
          #   name: Solar Radiation mean
          #   icon: mdi:weather-sunny
          # - sensor.htw_wetter_solar_radiation_max
          - sensor.aqi
      - type: "custom:auto-entities"
        card:
          type: entities
          title: currently
          show_header_toggle: false
        filter:
          include:
            - entity_id: sensor.weather_yr_*
          exclude:
            - entity_id: "/sensor.weather_yr_[1-9]h_/"
      # - type: "custom:auto-entities"
      #   card:
      #     type: entities
      #     title: currently
      #     show_header_toggle: false
      #   filter:
      #     include:
      #       - entity_id: sensor.htw_wetter_*
      - type: "custom:auto-entities"
        card:
          type: entities
          title: currently
          show_header_toggle: false
        filter:
          include:
            - entity_id: sensor.dwd_wetter_*
      - type: "custom:auto-entities"
        card:
          type: entities
          title: 1h
          show_header_toggle: false
        filter:
          include:
            - entity_id: sensor.weather_yr_1h_*
      - type: "custom:auto-entities"
        card:
          type: entities
          title: 6h
          show_header_toggle: false
        filter:
          include:
            - entity_id: sensor.weather_yr_6h_*

  - id: 8
    title: Plants
    icon: "mdi:leaf"
    cards:
      - type: plant-status
        entity: plant.miflora_1
      - type: plant-status
        entity: plant.miflora_2
      - type: plant-status
        entity: plant.miflora_3
      - type: plant-status
        entity: plant.miflora_4
      - type: vertical-stack
        cards:
          - type: "custom:auto-entities"
            card:
              show_header_toggle: false
              type: entities
              title: Plants that need help
            filter:
              template: |
                {% for plant in states.plant %}
                  {% if 'moisture low' in plant.attributes.problem %}
                    {{ plant.attributes.sensors.moisture }}
                  {% endif %}
                  {% if 'conductivity low' in plant.attributes.problem %}
                    {{ plant.attributes.sensors.conductivity }}
                  {% endif %}
                {% endfor %}
          - type: "custom:auto-entities"
            card:
              show_header_toggle: false
              type: entities
              title: Moisture Trend
            filter:
              include:
                - entity_id: binary_sensor.miflora_*_moisture_trend
  - id: 10
    title: Server
    icon: "mdi:server-network"
    panel: true
    cards:
      - type: custom:layout-card
        layout_type: custom:vertical-layout
        layout:
          max_columns: 2
        cards:
          - type: vertical-stack
            cards:
              - type: "custom:mini-graph-card"
                icon: "mdi:timer"
                align_icon: left
                align_state: right
                decimals: 1
                entities:
                  - entity: sensor.ping_google_dns
                    name: Ping
                hour24: true
                hours_to_show: 1
                line_width: 5
                lower_bound: 0
                name: Ping
                points_per_hour: 60
                show:
                  extrema: false
                  graph: bar
                  labels: false
                  legend: true
                  points: true
                color_thresholds:
                  - value: 20
                    color: "#4CAF50"
                  - value: 30
                    color: "#FF981A"
                  - value: 40
                    color: "#FF5252"
              - type: horizontal-stack
                cards:
                  - type: "custom:mini-graph-card"
                    update_interval: 120
                    align_icon: left
                    align_state: right
                    decimals: 0
                    entities:
                      - entity: sensor.router_wan_in_mbps
                        name: Download
                    hour24: true
                    hours_to_show: 1
                    line_width: 8
                    name: Download
                    points_per_hour: 50
                    aggregate_func: max
                    show:
                      labels: false
                      legend: true
                      points: hover
                      fill: false
                    color_thresholds:
                      - value: 0
                        color: "#4CAF50"
                      - value: 80
                        color: "#FF5722"
                      - value: 100
                        color: "#FF5252"
                    height: 200
                    icon: "mdi:download"
                    lower_bound: 0
                    upper_bound: 100
                  - type: "custom:mini-graph-card"
                    update_interval: 120
                    align_icon: left
                    align_state: right
                    decimals: 0
                    entities:
                      - entity: sensor.router_wan_out_mbps
                        name: Upload
                    hour24: true
                    hours_to_show: 1
                    line_width: 8
                    name: Upload
                    points_per_hour: 50
                    aggregate_func: max
                    show:
                      labels: false
                      legend: true
                      points: hover
                      fill: false
                    color_thresholds:
                      - value: 0
                        color: "#4CAF50"
                      - value: 30
                        color: "#FF5722"
                      - value: 40
                        color: "#FF5252"
                    height: 200
                    icon: "mdi:upload"
                    lower_bound: 0
                    upper_bound: 40
              - type: custom:mini-graph-card
                entities:
                  - sensor.router_wan_in_gb_daily
                name: Downloaded
                hours_to_show: 168
                aggregate_func: max
                group_by: date
                show:
                  graph: bar
              - type: custom:mini-graph-card
                entities:
                  - sensor.router_wan_out_gb_daily
                name: Uploaded
                hours_to_show: 168
                aggregate_func: max
                group_by: date
                show:
                  graph: bar
          - type: custom:layout-break
          - type: vertical-stack
            cards:
              - type: "custom:mini-graph-card"
                name: Streams
                entities:
                  - entity: sensor.plex
                    name: Streams
                    color: lightgrey
                align_icon: left
                align_state: right
                decimals: 0
                unit: Streams
                hour24: true
                hours_to_show: 24
                aggregate_func: max
                group_by: hour
                bar_spacing: 2
                lower_bound: 0
                show:
                  name: false
                  icon: false
                  extrema: false
                  graph: bar
                  labels: false
                  legend: true
                  points: true
              - type: "custom:auto-entities"
                card:
                  show_header_toggle: false
                  type: entities
                filter:
                  include:
                    - entity_id: media_player.plex_*
                  exclude:
                    - state: unavailable
              - type: "custom:mini-graph-card"
                align_icon: left
                align_state: right
                decimals: 0
                entities:
                  - entity: sensor.tautulli_lan_bandwidth
                    name: LAN
                  - entity: sensor.tautulli_wan_bandwidth
                    name: WAN
                hour24: true
                hours_to_show: 24
                aggregate_func: max
                line_width: 5
                height: 160
                lower_bound: 0
                name: Streaming Bandwidth
                points_per_hour: 1
                show:
                  state: false
                  labels: true
                  legend: true
                  extrema: true
                  points: hover
                icon: "mdi:server-network"
              - type: horizontal-stack
                cards:
                  - type: sensor
                    entity: sensor.omv_sda
                    graph: none
                  - type: sensor
                    entity: sensor.omv_sdc
                    graph: none
                  - type: sensor
                    entity: sensor.omv_sdd
                    graph: none
                  - type: sensor
                    entity: sensor.omv_sde
                    graph: none
  - id: 10
    title: System
    icon: "mdi:raspberry-pi"
    cards:
      - type: custom:button-card
        entity: sensor.cpu_temperature
        icon: "mdi:raspberry-pi"
        aspect_ratio: 1/1
        name: Server
        styles:
          card:
            - border-radius: 4%
            - padding: 10%
            - font-size: 10px
            - text-shadow: 0px 0px 5px black
            - text-transform: capitalize
          grid:
            - grid-template-areas: '"i temp" "n n" "cpu cpu" "ram ram" "sd sd"'
            - grid-template-columns: 1fr 1fr
            - grid-template-rows: 1fr min-content min-content min-content min-content
          name:
            - font-weight: bold
            - font-size: 13px
            - align-self: middle
            - justify-self: start
            - padding-bottom: 4px
          img_cell:
            - justify-content: start
            - align-items: start
            - margin: none
          icon:
            - color: >
                [[[
                  if (entity.state < 60) return 'lime';
                  if (entity.state >= 60 && entity.state < 80) return 'orange';
                  else return 'red';
                ]]]
            - width: 70%
            - margin-top: -10%
          custom_fields:
            temp:
              - align-self: start
              - justify-self: end
            cpu:
              - padding-bottom: 2px
              - align-self: middle
              - justify-self: start
              - --text-color-sensor: '[[[ if (states["sensor.cpu_temperature"].state > 80) return "red"; ]]]'
            ram:
              - padding-bottom: 2px
              - align-self: middle
              - justify-self: start
              - --text-color-sensor: '[[[ if (states["sensor.memory_use_percent"].state > 80) return "red"; ]]]'
        custom_fields:
          temp: >
            [[[
              return `<ha-icon
                icon="mdi:thermometer"
                style="width: 12px; height: 12px; color: yellow;">
                </ha-icon><span>${entity.state}°C</span>`
            ]]]
          cpu: >
            [[[
              return `<ha-icon
                icon="mdi:server"
                style="width: 12px; height: 12px; color: deepskyblue;">
                </ha-icon><span>CPU: <span style="color: var(--text-color-sensor);">${states['sensor.processor_use'].state}%</span></span>`
            ]]]
          ram: >
            [[[
              return `<ha-icon
                icon="mdi:memory"
                style="width: 12px; height: 12px; color: deepskyblue;">
                </ha-icon><span>RAM: <span style="color: var(--text-color-sensor);">${states['sensor.memory_use_percent'].state}%</span></span>`
            ]]]
      - entities:
          - sensor.wan_ip
          - sensor.connected_clients
          - sensor.github_home_assistant_release
          - sensor.ha_uptime
        show_header_toggle: false
        title: System
        type: entities
      - entities:
          - entity: zone.home
            icon: "mdi:home-assistant"
            name: HA
            tap_action:
              action: call-service
              service: homeassistant.restart
          - entity: zone.home
            icon: "mdi:cogs"
            name: Automation
            tap_action:
              action: call-service
              service: automation.reload
          - entity: zone.home
            icon: "mdi:script-text"
            name: Script
            tap_action:
              action: call-service
              service: script.reload
          - entity: zone.home
            icon: "mdi:group"
            name: Groups
            tap_action:
              action: call-service
              service: group.reload
        show_header_toggle: false
        show_state: false
        title: false
        type: glance
      - entities:
          - entity: sensor.count_automations
            name: Automations
          - entity: sensor.count_scripts
            name: Scripts
          - entity: sensor.count_device_trackers
            name: Device trackers
          - entity: sensor.count_binary_sensors
            name: Binary sensors
          - entity: sensor.count_sensors
            name: Sensors
          - entity: sensor.count_switches
            name: Switches
          - entity: sensor.count_zones
            name: Zones
          - entity: sensor.count_input_booleans
            name: Input booleans
        entity_id: sensor.date
        value_template: "{{ states.input_boolean | list | length }}"
        show_header_toggle: false
        show_icon: false
        title: false
        type: glance
      - type: vertical-stack
        cards:
          - type: "custom:auto-entities"
            card:
              show_header_toggle: false
              title: Things that might be broken
              type: entities
            filter:
              include:
                - state: unknown
                - state: unavailable
              exclude:
                - entity_id: group.*
                - entity_id: history_graph.*
                - entity_id: media_player.*
                - entity_id: sensor.chandelier_switch
                - entity_id: sensor.sonoff_*_version
            unique: true
          - type: "custom:auto-entities"
            card:
              show_header_toggle: false
              title: duplicates
              type: entities
            filter:
              include:
                - entity_id: /\_[2-9]$/
              exclude:
                - entity_id: /flora/
      - type: "custom:auto-entities"
        card:
          show_header_toggle: false
          title: Batteries
          type: entities
        filter:
          include:
            - domain: sensor
              attributes:
                device_class: battery
          exclude:
            - entity_id: sensor.disrupted_iphone_icloud_battery_state
            - entity_id: sensor.disrupted_ipadpro_icloud_battery_state
        sort:
          method: last_updated
          reverse: true

  - id: 11
    title: Location History
    icon: "mdi:map-clock"
    panel: false
    cards:
      - type: map
        hours_to_show: 24
        entities:
          - person.salomon
        card_mod:
          style: |
            div.leaflet-control-attribution {
              display: none;
            }
      - type: horizontal-stack
        cards:
          - type: "custom:button-card"
            entity: sensor.disrupted_iphone_battery_level
            entity_picture: /local/disrupted_iphone_icon.png
            show_entity_picture: true
            aspect_ratio: 1/1
            name: >-
              [[[
                  return states['device_tracker.disrupted_iphone'].attributes.friendly_name;
              ]]]
            styles:
              card:
                - border-radius: 4%
                - padding: 7%
                - padding-bottom: 4%
                - font-size: 10px
              grid:
                - grid-template-areas: '"i battery" "n n" "steps steps" "wifi wifi" "update update"'
                - grid-template-columns: 1fr 1fr
                - grid-template-rows: 1fr min-content min-content min-content min-content
              name:
                - font-weight: bold
                - font-size: 15px
                - align-self: middle
                - justify-self: start
                - padding-bottom: 6px
              img_cell:
                - justify-content: start
                - align-items: start
                - margin: none
              icon:
                - max-height: 90%
                - width: auto
                - height: auto
              custom_fields:
                battery:
                  - align-self: start
                  - justify-self: end
                  - font-size: 13px
                  - "--text-color-sensor": >-
                      [[[ if (entity.attributes['Low Power Mode']) return "#FFD616";
                      ]]]
                steps:
                  - padding-bottom: 2px
                  - align-self: middle
                  - justify-self: start
                  - font-size: 11px
                wifi:
                  - padding-bottom: 2px
                  - align-self: middle
                  - justify-self: start
                  - font-size: 11px
                  - "--text-color-sensor": >-
                      [[[ if (states["sensor.disrupted_iphone_connection_type"].state !== 'Wi-Fi') return "red";
                      ]]]
                update:
                  - align-self: middle
                  - justify-self: end
                  - font-size: 11px
            custom_fields:
              battery: |
                [[[
                  return `<ha-icon
                    icon="${entity.attributes.icon}"
                    style="width: 22px; height: 22px; color: var(--text-color-sensor);">
                    </ha-icon><span>${entity.state}%</span>`
                ]]]
              steps: |
                [[[
                  return `<ha-icon
                    icon="mdi:walk"
                    style="width: 20px; height: 20px;">
                    </ha-icon><span>  <span style="color: var(--text-color-sensor);">${states['sensor.disrupted_iphone_steps'].state}</span> steps</span>`
                ]]]
              wifi: |
                [[[
                  return `<ha-icon
                    icon="mdi:wifi"
                    style="width: 20px; height: 20px;">
                    </ha-icon><span>  <span style="color: var(--text-color-sensor);">${states['sensor.disrupted_iphone_ssid'].state}</span></span>`
                ]]]
              update: |
                [[[
                  return html`
                    ${states['sensor.disrupted_iphone_last_update_trigger'].state} <ha-relative-time
                      id="label"
                      class="ellipsis"
                      .hass="${hass}"
                      .datetime="${entity.last_updated}"
                    ></ha-relative-time>`
                ]]]
      - type: vertical-stack
        cards:
          - type: "custom:auto-entities"
            card:
              show_header_toggle: false
              type: entities
            filter:
              include:
                - entity_id: proximity.home
                - entity_id: device_tracker.disrupted_*phone*
              exclude:
                - entity_id: device_tracker.*_bt
              sort:
                method: last_changed
          - type: custom:auto-entities
            card:
              type: entities
              title: Battery warning
            filter:
              include:
                - domain: device_tracker
                  options:
                    secondary_info: last-changed
                  attributes:
                    battery: "< 25"
                    source_type: gps
          # - type: entities
          #   entities:
          #     - type: custom:secondaryinfo-entity-row
          #       entity: sensor.bvg_1
          #       name: !secret bvg_1_name_short
          #       secondary_info: '[[ if(sensor.bvg_1.attributes.delay == 0, "On Time", sensor.bvg_1.attributes.delay) ]][[ if(sensor.bvg_1.attributes.delay == 0, "", " min delayed") ]]'
          #     - type: custom:secondaryinfo-entity-row
          #       entity: sensor.bvg_2
          #       name: !secret bvg_2_name_short
          #       secondary_info: '[[ if(sensor.bvg_2.attributes.delay == 0, "On Time", sensor.bvg_2.attributes.delay) ]][[ if(sensor.bvg_2.attributes.delay == 0, "", " min delayed") ]]'
          #     - type: custom:secondaryinfo-entity-row
          #       entity: sensor.bvg_3
          #       name: !secret bvg_3_name_short
          #       secondary_info: '[[ if(sensor.bvg_3.attributes.delay == 0, "On Time", sensor.bvg_3.attributes.delay) ]][[ if(sensor.bvg_3.attributes.delay == 0, "", " min delayed") ]]'
          # - type: entities
          #   entities:
          #     - type: custom:secondaryinfo-entity-row
          #       entity: sensor.nextbike_berlin_home_d10c16ae8e0dae3ec9e6c1ba5a981399
          #       name: Hertzbergplatz
          #       secondary_info: "[[ sensor.nextbike_berlin_home_d10c16ae8e0dae3ec9e6c1ba5a981399.attributes.empty_slots ]] empty slots"
          #     - type: custom:secondaryinfo-entity-row
          #       entity: sensor.nextbike_berlin_home_5cecc6225df13d3d9cc9d83c33d7480f
          #       secondary_info: "[[ sensor.nextbike_berlin_home_5cecc6225df13d3d9cc9d83c33d7480f.attributes.empty_slots ]] empty slots"
          #     - type: custom:secondaryinfo-entity-row
          #       entity: sensor.nextbike_berlin_home_9d84d6515d01344f3f2b280ca274a817
          #       secondary_info: "[[ sensor.nextbike_berlin_home_9d84d6515d01344f3f2b280ca274a817.attributes.empty_slots ]] empty slots"
          # - type: entities
          #   entities:
          #     - type: custom:secondaryinfo-entity-row
          #       entity: sensor.populartimes_rewe
          #       secondary_info: "[[ sensor.populartimes_rewe_usual_difference ]] % compared to usually"
          #     - sensor.tree
          # - type: 'custom:auto-entities'
          #   title: Popular Times
          #   card:
          #     show_header_toggle: false
          #     type: entities
          #   filter:
          #     include:
          #       - entity_id: sensor.populartimes_*
